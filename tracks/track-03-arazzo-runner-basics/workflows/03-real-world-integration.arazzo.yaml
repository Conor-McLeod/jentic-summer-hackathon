arazzo: 1.0.0
info:
  title: Real-World Integration Workflow
  description: Fetch news, summarize, and post to Discord - demonstrates authentication and multi-API coordination
  version: 1.0.0

workflows:
  - workflowId: newsToDiscord
    description: Get latest tech news and post summary to Discord
    inputs:
      type: object
      properties:
        discord_channel_id:
          type: string
          description: Discord channel ID to post to
          example: "123456789012345678"
        news_category:
          type: string
          description: Category of news to fetch
          default: "technology"
          enum: ["business", "entertainment", "general", "health", "science", "sports", "technology"]
        max_articles:
          type: integer
          description: Maximum number of articles to process
          default: 3
          minimum: 1
          maximum: 10
        country:
          type: string
          description: Country code for news
          default: "us"
          example: "us"
      required: [discord_channel_id]

    steps:
      - stepId: fetchNews
        description: Fetch latest news articles from NewsAPI
        operationRef: '#/operations/getNewsHeadlines'
        parameters:
      - name: key
        in: query
        required: true
        schema:
          type: string
        description: Weather API key
      - name: q
        in: query
        required: true
        schema:
          type: string
        description: Location query (city name, coordinates, etc.)
      - name: aqi
        in: query
        required: false
        schema:
          type: string
          enum: ["yes", "no"]
          default: "no"]
        description: Include air quality data
          category: $inputs.news_category
          pageSize: $inputs.max_articles
          country: $inputs.country
        outputs:
          articles: $response.body.articles
          total_results: $response.body.totalResults
          status: $response.body.status

      - stepId: formatNewsMessage
        description: Format articles into a Discord-friendly message
        operationRef: '#/operations/formatNewsAsText'
        parameters:
          articles: $steps.fetchNews.outputs.articles
          category: $inputs.news_category
          total_available: $steps.fetchNews.outputs.total_results
        dependsOn: [fetchNews]
        outputs:
          formatted_message: $response.body.formatted_text
          article_count: $response.body.article_count

      - stepId: postToDiscord
        description: Post formatted message to Discord channel
        operationRef: '#/operations/sendDiscordMessage'
        parameters:
          channel_id: $inputs.discord_channel_id
          content: $steps.formatNewsMessage.outputs.formatted_message
        dependsOn: [formatNewsMessage]
        outputs:
          message_id: $response.body.id
          timestamp: $response.body.timestamp

      - stepId: getWeather
        description: Get current weather as additional context
        operationRef: '#/operations/getCurrentWeather'
        parameters:
          q: "San Francisco"  # Default location
        outputs:
          temperature: $response.body.current.temp_f
          condition: $response.body.current.condition.text
          location: $response.body.location.name

      - stepId: postWeatherUpdate
        description: Post weather update to same Discord channel
        operationRef: '#/operations/sendDiscordMessage'
        parameters:
          channel_id: $inputs.discord_channel_id
          content: "üå§Ô∏è Current weather in {location}: {temperature}¬∞F, {condition}"
        dependsOn: [postToDiscord, getWeather]
        outputs:
          weather_message_id: $response.body.id

operations:
  - operationId: getNewsHeadlines
    method: GET
    url: https://newsapi.org/v2/top-headlines
    description: Fetch top headlines from NewsAPI
    headers:
      X-API-Key: ${NEWS_API_KEY}
    parameters:
      - name: category
        in: query
        required: false
        schema:
          type: string
          enum: [business, entertainment, general, health, science, sports, technology]
        description: News category
      - name: pageSize
        in: query
        required: false
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
        description: Number of articles to fetch
      - name: country
        in: query
        required: false
        schema:
          type: string
          pattern: '^[a-z]{2}$'
          default: us
        description: 2-letter country code

  - operationId: formatNewsAsText
    method: POST
    url: https://httpbin.org/post
    description: Format news articles into readable text (simulated formatting service)
    headers:
      Content-Type: application/json
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              articles:
                type: array
                description: Array of news articles
              category:
                type: string
                description: News category
              total_available:
                type: integer
                description: Total articles available
            required: [articles]

  - operationId: sendDiscordMessage
    method: POST
    url: https://discord.com/api/v10/channels/{channel_id}/messages
    description: Send a message to a Discord channel
    headers:
      Authorization: Bot ${DISCORD_BOT_TOKEN}
      Content-Type: application/json
    parameters:
      - name: channel_id
        in: path
        required: true
        schema:
          type: string
        description: Discord channel ID
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              content:
                type: string
                maxLength: 2000
                description: Message content
              embeds:
                type: array
                description: Rich embeds (optional)
            required: [content]

  - operationId: getCurrentWeather
    method: GET
    url: https://api.weatherapi.com/v1/current.json
    description: Get current weather information
    parameters: